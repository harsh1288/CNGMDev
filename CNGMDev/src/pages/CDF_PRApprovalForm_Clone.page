<apex:page id="page" standardcontroller="Account"
    extensions="PRUpdateFormExtension" action="{!renderReadOnly}"
    sidebar="false" showHeader="true">
    <div class="slds">
        <apex:stylesheet value="{!URLFOR($Resource.SalesforceLightningDesign, 'assets/styles/salesforce-lightning-design-system-vf.css')}" />
        <meta http-equiv="X-UA-Compatible" content="IE=EmulateIE8" />
        <apex:stylesheet value="{!URLFOR($Resource.GoalsJs, 'assets/css/bootstrap.css')}" />
        <apex:stylesheet value="{!URLFOR($Resource.GoalsJs, 'assets/css/bootstrap-responsive.css')}" />
        <apex:includeScript value="{!URLFOR($Resource.GoalsJs, 'assets/js/bootstrap.js')}" />
    
        <apex:includeScript value="{!URLFOR($Resource.jquery_Js, 'jquery/js/jquery-1.7.2.min.js')}" />
        <apex:includeScript value="{!URLFOR($Resource.jquery_Js, 'jquery/js/jquery-ui-1.8.20.custom.min.js')}" />
        <apex:stylesheet value="{!URLFOR($Resource.jquery_Js, 'jquery/css/smoothness/jquery-ui-1.8.20.custom.css')}" />
        <style>
            input, textarea, .uneditable-input {
                width: 118px;
            }
            .bPageBlock .pbHeader {
                background-color: #0033FF;
            }
            
            .bPageBlock .pbBody {
                background-color: #F8F8F8;
            }
            
            .middle {
                vertical-align: left;
                background-color: #F8F8F8;
                color: black;
            }
            
            body .pbBody table.list tr.headerRow td,body .pbBody table.list tr.headerRow th
                {
                background: #007fcc;
                color: white;
            }
            
            .grant-dialog {
                
            }
            
            .ui-widget.success-dialog {
                font-family: Verdana, Arial, sans-serif;
                font-size: 1.0em;
            }
            
            .ui-widget-content.success-dialog {
                background: #FFF;
                border: 1px solid #FFF;
                color: #222222;
            }
            
            .ui-dialog.success-dialog {
                left: 0;
                outline: 0 none;
                padding: 0 !important;
                position: absolute;
                top: 0;
            }
            
            .ui-dialog.success-dialog .ui-dialog-content {
                background: none repeat scroll 0 0 transparent;
                border: 0 none;
                overflow: auto;
                position: relative;
                padding: 5 !important;
                margin: 0;
            }
            
            .ui-dialog.success-dialog .ui-widget-header {
                background: #FFF;
                border: 0;
                color: #fff;
                font-weight: normal;
            }
            
            .ui-widget-content.ui-dialog {
                border: 4px solid #007fcc;
            }
            
            .ui-dialog.success-dialog .ui-dialog-titlebar {
                padding: 0.1em .5em;
                position: relative;
                font-size: 1em;
            }
            .tableRowstyle {
                
                padding-left: 10px !important; 
                padding-right: 10px !important;
                overflow: hidden;
                white-space: nowrap;
            }
            .tableRowstyleRole {
               
                padding-left: 10px !important; 
                padding-right: 10px !important;
                 overflow: hidden;
                white-space: nowrap;
            }
            .tableRowstyleDetails{
                
                padding-left: 10px !important; 
                padding-right: 10px !important;
                 overflow: hidden;
                white-space: nowrap;
            }
            .selectListCss{
                
            }
            .bPageBlock .requiredInput .requiredBlock {
                background-color: #c00;
                position: absolute;
                left: -4px;
                width: 3px;
                top: 1px;
                bottom: 1px;
                height: 70%;    
            }
            .inputfld
            {
                width:35% !important;
                height:90% !important;
            }
            .inputfldtbl
            {
                height:80% !important;
                margin-bottom:0px !important;
                width:85% !important;
            } 
        </style>
        <script>
        
                        
            var previousOnload = window.onload;        
            window.onload = function() { 
            var newDoctype = document.implementation.createDocumentType(
     'html',
     '-//W3C//DTD XHTML 1.0 Transitional//EN',
     'http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtdd'
    );
    
    document.doctype.parentNode.replaceChild(newDoctype,document.doctype);
            HideLookup();
            if (previousOnload) { 
                previousOnload();
            }
            var links = document.getElementsByClassName("primaryCheckbox");
            var values = [].map.call(links, function (el) {
                return el.getAttribute("id");
            });
            for (var i=0;i<values.length;i++)
             { 
               if(document.getElementById(values[i]).checked) {
                 previousCheckId = values[i];
               }
             }
                
            }
           
           //----Updated by JL to hide the Lookup as style display none stops the rendering of the required values--------------------------------------------------------     
            function HideLookup()
            {
              document.getElementById('{!$Component.frm.pb2.contactrole2}' + "_lkwgt").style.display = 'none';
              document.getElementById('{!$Component.frm.pb2.contactrole3}' + "_lkwgt").style.display = 'none';
              document.getElementById('{!$Component.frm.pb2.contactrole4}' + "_lkwgt").style.display = 'none';
            }    
            //--------------------------
                
            function confirmPRUpdate() {
            
               var errorMessage = document.getElementById("{!$Component.frm.pageMessages}").textContent;
                if(errorMessage == null || errorMessage == '' || errorMessage == 'Information Saved Successfully.') {
                   //var result = confirm("You are about to submit your information for approval. Please remember to upload the required letters before submitting or your submission will be rejected automatically.  Are you sure you still want to submit now?");
                   //if(result) {
                       // action function 
                   //    updateAccountApprovalStatus();
                   //} else {
                   //}
                   //var dialog = $('<p>All forms submitted without uploading the mandatory documents listed will not be processed by the Global Fund.</p>').dialog({
                         //dialogClass: 'no-close success-dialog',
                         //modal: true,  
                         //buttons: {
                           //  "Ok": function() {
                             //   updateAccountApprovalStatus();
                             //},
                             //"Cancel":  function() {
                              //dialog.dialog('close');
                             //}
                         //}
                     //});
                     updateAccountApprovalStatus();
               } else {
                    $("html, body").animate({ scrollTop: 0 }, "slow");
               }
               
            }
            
            var previousCheckId;
            function toggle(chkBox) {
                if (chkBox.checked) {
                     if (previousCheckId) {
                          document.getElementById(previousCheckId).checked = false;
                     }
                     previousCheckId = chkBox.getAttribute('id');
                }
            }
    
            function onchange1(input) {
                toggle(input);
              
            }
            function  onSelect1() {
            }
            
            
 /*           function updateCCMContact(input,type) {
              var id = input.id + "_lkid";
              console.log('==='+id);
              updateCCMContactPro(document.getElementById(id).value , type);
              
            }
 */           
            
            function openContactLookUp(contactId) {
               //contactId = contactId + "_lkwgt";
              var originalbaseURL = "/apex/CDF_ContactLookup?txt="+contactId+"&accId={!account.Id}&frm={!$Component.frm}&lksrch=";
              originalbaseURL =  originalbaseURL + "&country={!account.Country__c}" ;
              openPopup(originalbaseURL, "lookup", 350, 480, "width="+670+",height=480,toolbar=no,status=no,directories=no,menubar=no,resizable=yes,scrollable=no", true);
                
            }
            
            function openGrantPopup() {
                 var dialog = $('<p>Do you want to save your changes before returning to the PR Forms page?</p>').dialog({
                 dialogClass: 'no-close success-dialog',
                 modal: true,    
                 buttons: {
                     "Yes": function() {
                        saveChangesAndRedirect();
                        //window.location.href = "../{!implementationPeriod.Id}";
                     },
                     "No":  function() {
                       // window.location.href = "../apex/grantmakingoverview?id={!implementationPeriod.Id}";
                    //   window.location.href = "../{!implementationPeriod.Id}";
                         window.location.href = "../apex/PRformList";
                     },
                     "Cancel":  function() {
                        //alert('you chose cancel');
                      dialog.dialog('close');
                     }
                 }
             });
            
            }
         function deleteRow(attachmentId) {
             var errMsg = "Are you sure?";
             var r=confirm(errMsg);
             if (r==true) {
               removeRow(attachmentId);
             }
             else {
                return false;
             }
        }
        function granteenamedisplay(type,legalname){
           
           var legal = document.getElementById('{!$Component.page:frm:pbNew:pbSection:legalItem:legalname}').value;
           
           var type= document.getElementById('{!$Component.page:frm:pbNew:pbSection:typeItem:type}').value;
           
           if(type == 'Governmental'){
              document.getElementById('{!$Component.frm.pb2.pbs2.grantee}').value = '{!account.Country_Official_Name__c}';
           }
           else{
              document.getElementById('{!$Component.frm.pb2.pbs2.grantee}').value = legal;
           }
        }
    </script>
    
    
    <script>
      function setFocusOnLoad() {}
    </script>
    
    
        <apex:sectionHeader title="Update PR Information" />
        <center><b><font size="4">PRINCIPAL RECIPIENT (PR) 
        INFORMATION FORM</font><br />
    
        <font size="3">To be filled by the Principal Recipient
        Authorized Personnel</font></b></center>
        <br>
        </br>
        <p class="slds-text-body--small slds-m-top--x-small">            
        The Principal Recipient (PR) is responsible for the accuracy and completeness of the data entered in this form. The PR is also responsible in maintaining the accuracy of this record with the Global fund at all times and MUST inform the Global Fund of all changes/modification of this record by submitting a new form.
    
        The Global Fund is not responsible for any delay in disbursement resulting from incorrectly supplied PR and banking information. Bank charges resulting from incorrectly supplied information will be deducted from the grant funds.
    
        Processing this form after receipt by the Global Fund will take some time due to the verification and due-diligence requirements.  Please allow sufficient time (at least 10 days) for this form to be processed to ensure timely grant signing and disbursement processing.
        </p>
        <br>
        </br>
        <center><b>This form is a mandatory requirement for the
        signing of the Grant Agreement and activation of the signed Grant
        Agreement for any Disbursement of funds by the Global Fund </b></center>
    
        <br />
        <apex:outputLink onclick="openGrantPopup()" value="javascript:void(0);"
            style="color:blue;float: left;">Return to PR Form</apex:outputLink>
        <br>
        </br>       
        
        <apex:form id="frm">
            <apex:pageMessages id="pageMessages" escape="false" />
 <!--            <apex:actionFunction action="{!updateCCMContact}"
                name="updateCCMContactPro" rerender="GrantDiv,newOP,ccmSection"
                oncomplete="HideLookup();">
                <apex:param name="firstParam" assignTo="{!CCMContactId}" value="" />
                <apex:param name="secondParam" assignTo="{!CCMContactType}" value="" />
            </apex:actionFunction>
-->            <apex:actionFunction name="updateLFAContact" status="status" reRender="pbTable2" />
            <apex:actionFunction name="updateAccountApprovalStatus" action="{!updateAccountApprovalStatus}" />
            <apex:actionFunction name="saveChangesAndRedirect" action="{!saveChangesAndRedirect}"/>
            <apex:actionFunction action="{!removeRow}" name="removeRow" status="status" rerender="pageMessages,attachList">
                <apex:param name="firstParam" assignTo="{!attachmentIdToDelete}" value="" />
            </apex:actionFunction>
        <!-- FORM STATUS SECTION -->
            <apex:pageblock title="Form Status">
                <apex:pageblockButtons location="top">          
                    <apex:commandButton styleClass="slds-button slds-button--neutral slds-max-small-button--stretch" style="white-space:nowrap;background-color:rgb(21, 159, 240);color:white;" value="Save Changes" action="{!saveRecord}" status="status" rerender="pbNew,blkprim, pb2,pageMessages"/>
                    <apex:commandButton styleClass="slds-button slds-button--neutral slds-max-small-button--stretch" style="white-space:nowrap;background-color:rgb(21, 159, 240);color:white;width:30%;" value="Submit PR Information for Approval" action="{!submittForApproval}" rerender="pageMessages,pb2" oncomplete="confirmPRUpdate()" />           
                </apex:pageblockButtons>            
                <apex:pageBlockSection columns="2" collapsible="true">
                    <apex:pageBlockSectionItem >
                        <apex:outputLabel value="Approval Status"
                            for="Approval_Status__name" />
                        <apex:outputText value="{!account.Approval_Status__c}"
                            id="Approval_Status__name" />
                    </apex:pageBlockSectionItem>
                    <!--    <apex:outputField value="{!account.Approval_Status__c}" label="Approval Status"/>-->
                    <apex:pageBlockSectionItem >
                        <apex:outputLabel value="Approval Status Explanation"
                            for="Approval_Status_Explanation__name" />
                        <apex:outputText value="{!account.Approval_Status_Explanation__c}"
                            id="Approval_Status_Explanation__name" />
                    </apex:pageBlockSectionItem>                
                </apex:pageBlockSection>
            </apex:pageblock>
        <!-- MAIN PR INFORMATION SECTION -->
            <apex:pageblock title="Principal Recipient Information" id="pbNew">
                <apex:pageBlockSection columns="2" collapsible="true" id="pbSection">
                <apex:outputText value="{!account.Name}" label="PR Organization"/>                
                <apex:inputField styleClass="inputfld" value="{!account.PR_Validity_Period_Start_Date__c}" />                                
                    <apex:pageBlockSectionItem id="legalItem" >
                        <apex:outputLabel value="Full Legal Name"/>
                        <apex:outputPanel >
                           <div class="requiredInput">
                               <div class="requiredBlock"></div>  
                             
                               <apex:inputField styleClass="inputfld" id="legalname" value="{!account.Full_Legal__c}"  onchange="granteenamedisplay('{!$Component.type}','{!$Component.legalname}');"/>
                            </div>  
                        </apex:outputpanel>            
                    </apex:pageBlockSectionItem>                
                    <apex:inputField styleClass="inputfld" value="{!account.PR_Validity_Period_End_Date__c}" />                
                    <apex:pageBlockSectionItem >
                        <apex:outputLabel value="Official Abbreviation"/>
                        <apex:outputPanel >
                            <div class="requiredInput">
                                <div class="requiredBlock"></div>                         
                                <apex:inputField styleClass="inputfld" value="{!account.Legal_Abbreviation__c}"/>
                            </div>  
                        </apex:outputpanel>            
                    </apex:pageBlockSectionItem>                                                                               
             <!--            <apex:outputText value="{!Implementation_Period__c.Country__c}" label="Grant Country"/>
             -->                  
                    <apex:pageBlockSectionItem >
                        <apex:outputLabel value="Address line 1"/>
                        <apex:outputPanel >
                            <div class="requiredInput">
                                <div class="requiredBlock"></div>                     
                                <apex:inputField styleClass="inputfld" value="{!account.Address_line_1__c}"/>        
                            </div>  
                        </apex:outputpanel>            
                    </apex:pageBlockSectionItem>                
                    <apex:inputField styleClass="inputfld" value="{!account.Country_Fiscal_Cycle__c}"/>
                    <apex:inputField styleClass="inputfld" value="{!account.Address_line_2__c}"/>                                
                    <apex:pageBlockSectionItem id="typeItem">
                        <apex:outputLabel value="PR Type"/>
                        <apex:outputPanel >
                            <div class="requiredInput">
                                <div class="requiredBlock"></div>                     
                                <apex:inputField styleClass="inputfld" value="{!account.PR_Type__c}"  id="type" onchange="granteenamedisplay('{!$Component.type}','{!$Component.legalname}');"/>
                           </div>  
                       </apex:outputpanel>            
                    </apex:pageBlockSectionItem>                                               
                    <apex:inputField styleClass="inputfld" value="{!account.Address_line_3__c}"/>
                    <apex:inputField styleClass="inputfld" value="{!account.PR_Sub_Type__c}"/>                
                    <apex:pageBlockSectionItem >
                       <apex:outputLabel value="City"/>
                       <apex:outputPanel >
                           <div class="requiredInput">
                               <div class="requiredBlock"></div>  
                               <apex:inputField styleClass="inputfld" value="{!account.City__c}"/>
                           </div>  
                        </apex:outputpanel>            
                    </apex:pageBlockSectionItem>                
                    <apex:pageBlockSectionItem >
                        <apex:outputLabel value="PR Fiscal Cycle Start Month"/>
                        <apex:outputPanel >
                            <div class="requiredInput">
                                <div class="requiredBlock"></div>                      
                                <apex:inputField styleClass="inputfld" value="{!account.PR_Fiscal_Cycle_Start_Month__c}" />
                            </div>  
                        </apex:outputpanel>            
                     </apex:pageBlockSectionItem>                   
                     <apex:inputField styleClass="inputfld" value="{!account.State_Province__c}" />                
                     <apex:pageBlockSectionItem >
                        <apex:outputLabel value="PR Fiscal Cycle Start Day"/>
                            <apex:outputPanel >
                            <div class="requiredInput">
                                <div class="requiredBlock"></div>                      
                                <apex:inputField styleClass="inputfld" value="{!account.PR_Fiscal_Cycle_Start_Day__c}" />
                            </div>  
                        </apex:outputpanel>            
                     </apex:pageBlockSectionItem>                
                     <apex:inputField styleClass="inputfld" value="{!account.Zip_Postal_Code__c}"/>                
                     <apex:pageBlockSectionItem >
                        <apex:outputLabel value="PR Fiscal Cycle End Month"/>
                        <apex:outputPanel >
                            <div class="requiredInput">
                                <div class="requiredBlock"></div>                       
                                <apex:inputField value="{!account.PR_Fiscal_Cycle_End_Month__c}" />
                            </div>  
                        </apex:outputpanel>            
                     </apex:pageBlockSectionItem>                                               
                     <apex:pageBlockSectionItem >
                         <apex:outputLabel value="Country (Mailing Address)"/>
                             <apex:outputPanel >
                                 <div class="requiredInput">
                                     <div class="requiredBlock"></div>                      
                                     <apex:inputField styleClass="inputfld" value="{!account.Country_address__c}" />
                                 </div>  
                             </apex:outputpanel>            
                     </apex:pageBlockSectionItem>                
                     <apex:pageBlockSectionItem >
                         <apex:outputLabel value="PR Fiscal Cycle End Day"/>
                             <apex:outputPanel >
                                 <div class="requiredInput">
                                     <div class="requiredBlock"></div>                          
                                     <apex:inputField styleClass="inputfld" value="{!account.PR_Fiscal_Cycle_End_Day__c}"/>                                                            
                                 </div>  
                             </apex:outputpanel>            
                     </apex:pageBlockSectionItem>
                </apex:pageBlockSection>
        <!-- added section for Primary Contact address fields -->
                <apex:outputPanel id="primaryCon">
                    <apex:pageBlock id="blkprim" title="Primary Contact Address">
                        <apex:pageBlockSection id="secprim" columns="2">                    
                            <apex:pageBlockSectionItem id="pAddrLine1Item" >
                                <apex:outputLabel value="Address line 1"/>
                                <apex:outputPanel >
                                    <div class="requiredInput">
                                        <div class="{!IF(account.Different_Primary_Contact_Address__c == true, 'requiredBlock', '')}"></div>                                  
                                            <apex:inputField styleClass="inputfld" id="add1_prim" value="{!account.Address_line_1_Primary__c}"/>
                                        </div>  
                                </apex:outputpanel>            
                            </apex:pageBlockSectionItem> 
                            <apex:inputField styleClass="inputfld" id="add2_prim" value="{!account.Address_line_2_Primary__c}" />     
                            <apex:inputField styleClass="inputfld" id="add3_prim" value="{!account.Address_line_3_Primary__c}" />                        
                                <apex:pageBlockSectionItem id="pCityItem">
                                    <apex:outputLabel value="City"/>
                                    <apex:outputPanel >
                                        <div class="requiredInput">
                                            <div class="{!IF(account.Different_Primary_Contact_Address__c == true, 'requiredBlock', '')}"></div>                                  
                                            <apex:inputField styleClass="inputfld" id="city_prim" value="{!account.City_Primary__c}"/>
                                        </div>  
                                    </apex:outputpanel>            
                                </apex:pageBlockSectionItem>                        
                                <apex:pageBlockSectionItem id="pStateItem">
                                    <apex:outputLabel value="State/Province"/>
                                    <apex:outputPanel >
                                        <div class="requiredInput">
                                            <div class="{!IF(account.Different_Primary_Contact_Address__c == true, 'requiredBlock', '')}"></div>                                  
                                            <apex:inputField styleClass="inputfld" id="state_prim" value="{!account.State_Province_Primary__c}"/>                
                                        </div>  
                                    </apex:outputpanel>            
                                </apex:pageBlockSectionItem>
                                <apex:pageBlockSectionItem id="pPostalItem">
                                    <apex:outputLabel value="Zip/Postal Code"/>
                                    <apex:outputPanel >
                                        <div class="requiredInput">
                                            <div class="{!IF(account.Different_Primary_Contact_Address__c == true, 'requiredBlock', '')}"></div>                                 
                                            <apex:inputField styleClass="inputfld" id="zip_prim" value="{!account.Zip_Postal_Code_Primary__c}"/>
                                        </div>  
                                   </apex:outputpanel>            
                                </apex:pageBlockSectionItem>                                               
                                <apex:pageBlockSectionItem id="pCountryItem">
                                    <apex:outputLabel value="Country (Mailing Address)"/>
                                    <apex:outputPanel >
                                        <div class="requiredInput">
                                            <div class="{!IF(account.Different_Primary_Contact_Address__c == true, 'requiredBlock', '')}"></div>                                  
                                            <apex:inputField id="cntry_prim" value="{!account.Country_Mailing_Address_Primary__c}"/>
                                        </div>  
                                    </apex:outputpanel>            
                                 </apex:pageBlockSectionItem>                        
        <!-- SCRIPTS FOR CONDITIONAL DISABLING OF INPUT FIELDS -->
                        </apex:pageBlockSection>
                    </apex:pageBlock>
                        <script>
                            if({!account.Different_Primary_Contact_Address__c}==false)
                            {                   
                                document.getElementById('{!$Component.page:frm:pbNew:blkprim:secprim:pAddrLine1Item:add1_prim}').disabled=true;
                                document.getElementById('{!$Component.page:frm:pbNew:blkprim:secprim:add2_prim}').disabled=true;
                                document.getElementById('{!$Component.page:frm:pbNew:blkprim:secprim:add3_prim}').disabled=true;
                                document.getElementById('{!$Component.page:frm:pbNew:blkprim:secprim:pCityItem:city_prim}').disabled=true;
                                document.getElementById('{!$Component.page:frm:pbNew:blkprim:secprim:pStateItem:state_prim}').disabled=true;
                                document.getElementById('{!$Component.page:frm:pbNew:blkprim:secprim:pPostalItem:zip_prim}').disabled=true;
                                document.getElementById('{!$Component.page:frm:pbNew:blkprim:secprim:pCountryItem:cntry_prim}').disabled=true;
                            }                
                        </script>
                </apex:outputPanel>
            </apex:pageblock>
            <apex:pageblock title="Grant Specific Information" id="pb2">
         <!--            <apex:pageBlockSection columns="2" collapsible="true" id="pbs2">
                        <apex:pageBlockSectionItem >
                            <apex:outputLabel value="Implementation Period Name"
                                for="implementationPeriod__name" />
                            <apex:outputText value="{!implementationPeriod.name}"
                                id="implementationPeriod__name" />
                        </apex:pageBlockSectionItem>
        
                           <apex:pageBlockSectionItem id="pPostalItem">
                                   <apex:outputLabel value="Grant Tax Exemption"/>
                                   <apex:outputPanel >
                                        <div class="requiredInput">
                                            <div class="requiredBlock"></div>  
                                                  <apex:inputField value="{!implementationPeriod.Grant_Tax_Exemption__c}"/>
                                         </div>  
                                    </apex:outputpanel>            
                                 </apex:pageBlockSectionItem> 
        
        
                        <apex:inputField id="grantee" value="{!account.Grantee_Name__c}" style="width: 175px;height: 75px;"/>
                    </apex:pageBlockSection>
        
            -->
                    <br>
                    <span style="font-size: 17px;">
                    <h3>Principal Recipient Contacts</h3>
                    </span>
                    </br>
                    <b><i> You must have a contact for all the first two Authorized
                    Signatory roles who will be associated with this Grant Implementation
                    Period (the second Authorized Signatory for Disbursement Request is optional). You can either search and select an existing contact or enter
                    a new contact by filling in the blank fields. You must also indicate
                    <u>one</u> primary contact for the PR by checking the 'Primary
                    Contact' checkbox. </i></b>
                    
        <!--             <div style="opacity: 0; height: 0px;width: 0px;"><apex:inputField value="{!implementationPeriod.Auth_Sig_for_Grant_Agreement__c}"
                                style="width:0%;height:0px" id="contactrole2"
                                onChange="updateCCMContact(this,'grant');"></apex:inputField></div>
                    <div style="opacity: 0; height: 0px;width: 0px;"><apex:inputField value="{!implementationPeriod.Auth_Sig_for_Disbursement_Request_1__c}"
                                style="width:0%;height:0px" id="contactrole3"
                                onChange="updateCCMContact(this,'request1');"></apex:inputField></div>
                    <div style="opacity: 0; height: 0px ;width: 0px;"><apex:inputField value="{!implementationPeriod.Auth_Sig_for_Disbursement_Request_2__c}"
                                style="width:0%;height:0px" id="contactrole4"
                                onChange="updateCCMContact(this,'request2');"></apex:inputField></div> 
         -->                                    
                    <apex:outputPanel id="GrantDiv">    
                            <apex:outputPanel id="indexCounter">
                                <apex:variable var="index" value="{!0}" />
                                <apex:variable var="checkindex" value="{!0}" />
                                    <apex:outputPanel id="newOP">  
                                        <table class="list"  style="background-color: white;table-layout: fixed;width:100%;">
                                            <tr class="headerRow ">
                                                <th class="headerRow tableRowstyleDetails" style="width:9%">
                                                Primary Contact</th>
                                                <th class="headerRow tableRowstyleRole" style="width:13%">
                                                Role</th>
                                                <th class="headerRow tableRowstyleDetails" style="width:8.5%" >
                                                Salutation</th>
                                                <th class="headerRow tableRowstyle" style="width:10%">First Name</th>
                                                <th class="headerRow tableRowstyle" style="width:10%">Last Name</th>
                                                <th class="headerRow tableRowstyle" style="width:7%">Title</th>
                                                <th class="headerRow tableRowstyle" style="width:12%">Email</th>
                                                <th class="headerRow tableRowstyle" style="width:11%">Phone</th>
                    <!-- PP: Adding fax and department for New Requirement  -->
                                                <th class="headerRow tableRowstyle" style="width:10%">Fax</th>
                                                <th class="headerRow tableRowstyle" style="width:10%">Department</th>
                                            </tr>
                                        <apex:variable var="rowCount" value="{!0}"/>
                                        <apex:repeat id="pbTable1" value="{!listContacts}" var="contactNew">                        
					                        <tr class="dataCell  ">
					                            <td class="dataCell tableRowstyleDetails">
					                                <span style="width: 80px; text-align: center; padding-left: 17px;" >
					                               <apex:commandLink style="text-decoration:none;text-align:center"
					                                    action="{!deleteRowCon}" rerender="indexCounter"
					                                    status="status">
					                                    <i class="icon-trash icon-black" /> <apex:param name="q"
					                                        assignTo="{!selectedIndex}" value="{!rowCount}" />
					                                </apex:commandLink>
					                            <apex:variable var="index" value="{!index+1}" /> 
					                    <!-- PP: Added for new Requiremnet -->
                                                    <img src="/s.gif" alt="CCM Chair Lookup (New Window)"
                                                           class="lookupIcon" onblur="this.className = 'lookupIcon';"
                                                           onfocus="this.className = 'lookupIconOn';"
                                                           onmouseout="this.className = 'lookupIcon';this.className = 'lookupIcon';"
                                                           onmouseover="this.className = 'lookupIconOn';this.className = 'lookupIconOn';"
                                                           title="Additional Contact Lookup (New Window)"
                                                           onclick="openContactLookUp('page:frm:pb2:pbTable1:'+'{!rowCount}');" />                                                          
                                                    <apex:inputCheckbox styleclass="primaryCheckbox"
                                                         value="{!contactNew.Primary_Contact__c}" id="CheckBox"
                                                         onclick="onchange1(this)" style="margin-left:10px">
                                                    </apex:inputCheckbox>                   
                                <apex:variable var="checkindex" value="{!checkindex+1}" /> </span> 
                                                </td>
                                                <td class="dataCell  tableRowstyleRole">                            
                                                    <apex:actionRegion >
                                                        <apex:selectList id="chooseColor" value="{!contactNew.Role__c}"
                                                            size="1" style="width: 90%;"  styleClass="selectListCss">
                                                            <apex:selectOptions value="{!ContactRoleList}" />
                                                        </apex:selectList>
                                                    </apex:actionRegion>
                                                </td>
                                                <td class="dataCell tableRowstyleDetails">
                                                    <apex:inputField value="{!contactNew.salutation}" style="width:95%" id="salutation"/>                          
                                                </td>
                                                <td class="dataCell  tableRowstyle">
                                                    <div class="requiredInput">
                                                        <div class="{!IF(blnFinanceMode,'','requiredBlock')}"></div>
                                                        <apex:inputField value="{!contactNew.FirstName}" styleclass="inputfldtbl"  style="margin-left: 7px;" id="FName"/>
                                                    </div>                            
                                                </td>
                                                <td class="dataCell  tableRowstyle">
                                                    <div class="requiredInput">
                                                        <div class="{!IF(blnFinanceMode,'','requiredBlock')}"></div>
                                                        <apex:inputField value="{!contactNew.LastName}" styleclass="inputfldtbl" style="margin-left: 7px;" required="false" id="LName"/>
                                                    </div>
                                                </td>
                                                <td class="dataCell  tableRowstyle">
                                                    <div class="requiredInput">
                                                        <div class="{!IF(blnFinanceMode,'','requiredBlock')}"></div>
                                                        <apex:inputField value="{!contactNew.Title}" styleclass="inputfldtbl" style="margin-left: 7px;" id="Title"/>
                                                    </div>                              
                                                </td>
                                                <td class="dataCell  tableRowstyle">
                                                    <div class="requiredInput">
                                                        <div class="{!IF(blnFinanceMode,'','requiredBlock')}"></div>
                                                        <apex:inputField styleclass="inputfldtbl" style="margin-left: 7px;" value="{!contactNew.Email}" id="Email"></apex:inputField>
                                                    </div>
                                                </td>
                                                <td class="dataCell  tableRowstyle">
                                                    <apex:inputField value="{!contactNew.Phone}" style="width: 85%;margin-left: 7px;margin-bottom:0px;height:130%;" id="Phone"/> 
                                                </td>
                                                <td class="dataCell  tableRowstyle">
                                                    <apex:inputField value="{!contactNew.Fax}" style="width: 85%;margin-left: 7px;margin-bottom:0px;height:130%;" id="Fax"/> 
                                                </td>
                                                <td class="dataCell  tableRowstyle">
                                                    <apex:inputField value="{!contactNew.Department}" style="width: 85%;margin-left: 7px;margin-bottom:0px;height:130%;" id="Department" /> 
                                                </td>
                                            </tr>
                                            <apex:variable var="rowCount" value="{!rowCount+1}"/>
                                            </apex:repeat>
                                        </table>
                                    </apex:outputPanel>
                            </apex:outputPanel>
                    </apex:outputPanel>
                    <br />
                    <apex:commandButton styleClass="slds-button slds-button--neutral slds-max-small-button--stretch" style="white-space:nowrap;background-color:rgb(21, 159, 240);color:white;" value="Add New PR Contact"
                                    action="{!addNewPRContact}"  rerender="newOP" status="status" />
                    <apex:outputpanel ><br/><br/>                
                        <apex:actionstatus id="status">
                            <apex:facet name="start">
                                <div class="waitingSearchDiv" id="el_loading"
                                    style="background-color: #fbfbfb; height: 100%; opacity: 0.65; width: 100%; z-index: 9000;">
                                    <div class="waitingHolder" style="top: 1074.2px; width: 91px;">
                                        <img class="waitingImage" src="/img/loading.gif"
                                        title="Please Wait..." />
                                        <span class="waitingDescription">Please Wait...</span>
                                    </div>
                                </div>
                            </apex:facet>
                        </apex:actionstatus>
                    </apex:outputpanel>
<!-- added action function to call method on radio button selection for Primary Contact address-->
                    <apex:actionFunction action="{!showHideAddress}" name="PrimAddress" status="status"  rerender="primaryCon,pageMessages">
                        <apex:Param id="par1" name="par1" value="" assignTo="{!account.Different_Primary_Contact_Address__c}"/>
                    </apex:actionFunction>
                    <h4>
                        <apex:outputText value="Does the primary contact address differ from the address entered above? "></apex:outputText>
                    </h4>
                    <br/><br/> 
                    <apex:selectRadio style="width:10%;margin-left:15px;" value="{!account.Different_Primary_Contact_Address__c}" onchange="PrimAddress(this.value)">
                        <apex:selectOption itemEscaped="false" itemLabel=" Yes &nbsp;&nbsp;&nbsp;&nbsp;" itemValue="true" />
                        <apex:selectOption itemLabel=" No " itemValue="false"/>
                    </apex:selectRadio><p/>
            </apex:pageblock>            
            <center>
                <div style="width: 85%; background-color: #D0D0D0; border-style: solid; border-width: 3px;">
                    <table style="width: 100%;">
                        <tr>
                            <td width="5%"></td>
                            <td colspan="2">
                                <h3 style="margin-bottom: 0;">Mandatory Documents to Upload in
                                'Notes and Attachments' section below:</h3>
                            </td>
                            <td></td>
                        </tr>
                        <tr>
                            <td width="5%"></td>
                            <td align="left">1. PR letter with specimen signatures for
                            confirmation of PR authorized signatories for signing of grant
                            agreement and disbursements (on official PR letterhead) &nbsp;&nbsp;</td>
                            <td align="left">&nbsp;&nbsp;
        <!-- changed source as per the request, now it points to globalfund site and CM Letter is no more required -->
        <!-- <apex:outputLink style="color:blue;" value="http://www.theglobalfund.org/documents/core/financial/Core_2014-PrincipalRecipientSignatoryInformation_Template_en/">-->Download PR Letter Template <br/><!-- </apex:outputLink> -->
                            <apex:outputLink style="color:blue;" value="http://www.theglobalfund.org/documents/core/financial/Core_2014-PrincipalRecipientSignatoryInformation_Template_en/">[ English |</apex:outputLink> 
                            <apex:outputLink style="color:blue;" value="http://www.theglobalfund.org/documents/core/financial/Core_2014-PrincipalRecipientSignatoryInformation_Template_es/"> Español |</apex:outputLink> 
                            <apex:outputLink style="color:blue;" value="http://www.theglobalfund.org/documents/core/financial/Core_2014-PrincipalRecipientSignatoryInformation_Template_fr/"> Français |</apex:outputLink> 
                            <apex:outputLink style="color:blue;" value="http://www.theglobalfund.org/documents/core/financial/Core_2014-PrincipalRecipientSignatoryInformation_Template_ru/"> Русский ] </apex:outputLink> 
                            </td>
                        </tr>
                    </table>
                </div>
            </center>
            <br />
            <apex:pageblock title="Notes & Attachments" id="attachList">
                <apex:pageblockButtons location="top">
                    <apex:commandButton value="Attach File" styleClass="slds-button slds-button--neutral slds-max-small-button--stretch" style="white-space:nowrap;background-color:rgb(21, 159, 240);color:white;" action="{!attachfile}" />
                </apex:pageblockButtons>
                <apex:pageblockTable value="{!lstAttachment}" var="a">
                    <apex:column headerValue="" style="width: 70px;">
                        <apex:commandLink rerender="attachList" style="color:blue;"
                               status="status" onclick="deleteRow('{!a.Id}');return false;">
                               <i class="icon-trash icon-black" style="margin-left: 10px;"/>
                        </apex:commandLink>               
                    </apex:column>
                    <apex:column headerValue="Title" >
                        <a style="cusror:pointer;text-decoration: underline;color: blue;" href="/servlet/servlet.FileDownload?file={!a.id}" download="{!a.name}">{!a.name}</a> 
                    </apex:column>
                    <apex:column headerValue="Related To" value="{!a.ParentId}" />
                    <apex:column headerValue="Last Modified" value="{!a.lastModifiedDate}" />
                    <apex:column headerValue="Created By" value="{!a.CreatedById}" />
                </apex:pageblockTable>
            </apex:pageblock>
                <br>
                </br>
                <apex:inputField style="width: 95px;margin-left: 25px;"
                    value="{!account.Ethics_COI_Code_of_Conduct__c}"></apex:inputField>&nbsp;&nbsp;
                <span style="font-size: 17px;"> I confirm that I have read, understood and comply with the <!-- &nbsp; <apex:outputLink style="color:blue;" target="_blank"
                    value="http://intranet.theglobalfund.org/Procurement/Documents/Site%20content/Suppliers/Core_EthicsAndConflictOfInterest_Policy_en%5B1%5D.pdf">Policy on Ethics and Conflicts of Interests</apex:outputLink>
                &nbsp;as well as the --> &nbsp; <apex:outputLink style="color:blue;" target="_blank"
                    value="http://www.theglobalfund.org/documents/corporate/Corporate_CodeOfConductForRecipients_Policy_en/">Global Fund Code of Conduct for Recipients of Global Fund Resources.</apex:outputLink>
                </span>
                <br />
                <br>
                </br>
            <apex:pageblock >
                <apex:pageblockButtons location="top">                
                    <apex:commandButton value="Save Changes" styleClass="slds-button slds-button--neutral slds-max-small-button--stretch" style="white-space:nowrap;background-color:rgb(21, 159, 240);color:white;" action="{!saveRecord}" status="status" rerender="pageMessages"/>                
                    <apex:commandButton value="Submit PR Information for Approval" styleClass="slds-button slds-button--neutral slds-max-small-button--stretch" style="white-space:nowrap;background-color:rgb(21, 159, 240);color:white;" 
                        action="{!submittForApproval}" rerender="pageMessages"
                        oncomplete="confirmPRUpdate()" />
                </apex:pageblockButtons>
            </apex:pageblock>
            <br />
        </apex:form>
        
        <!-- 
            <apex:outputPanel rendered="false" id="opt">{! Implementation_Period__c.Principal_Recipient__c }{! Implementation_Period__c.Local_Fund_Agent__c } 
        {!Implementation_Period__c.CCM_Chair__c}{!Implementation_Period__c.CCM_Civil_Society_Representative__c}{!Implementation_Period__c.Approval_Status_Explanation__c } 
        {!Implementation_Period__c.Grant_Tax_Exemption__c }   {!Implementation_Period__c.Name}   {!Implementation_Period__c.Auth_Sig_for_Grant_Agreement__c}   {!Implementation_Period__c.Auth_Sig_for_Disbursement_Request_1__c} 
          {!Implementation_Period__c.Auth_Sig_for_Disbursement_Request_2__c}   
        </apex:outputPanel>
        -->
        <script>
          // -----------------------------------------------------
          // This javascript code used to open custom Account lookup
          // -----------------------------------------------------
          function clearchkbx(row)
          {
            document.getElementById('page:frm:pb2:CheckBox2').checked = false;
            document.getElementbyId(row).checked=false;
          }
         
          function openLookup(baseURL,width,modified,searchParam) {
            var originalbaseURL = baseURL;    
            var originalwidth = width;
            var lookupType = baseURL.substr(baseURL.length-3,3);
            if (modified == '1') baseURL = baseURL + searchParam;   
                var urlArr = baseURL.split("&");
                var txtId = '';
                var accId = '';
                if(urlArr.length > 2) {
                    urlArr = urlArr[1].split('=');
                    txtId = urlArr[1];             
                }
                baseURL = "/apex/CDF_ContactLookup?txt=" + txtId;     
                baseURL =  baseURL + "&country={!account.Country__c}" ;
                baseURL = baseURL + "&frm=" + escapeUTF("{!$Component.frm}");  
                if (modified == '1') {
                    baseURL = baseURL + searchParam;
                } 
           if(lookupType != "003") {    
               openPopup(originalbaseURL, "lookup", 350, 480, "width="+originalwidth+",height=480,toolbar=no,status=no,directories=no,menubar=no,resizable=yes,scrollable=no", true);
           } else {
                openPopup(baseURL, "lookup", 350, 480, "width="+width+",height=480,toolbar=no,status=no,directories=no,menubar=no,resizable=yes,scrollable=no", false);
           }   
            
         }
          // ---------------------------------------------------
        </script>
    </div>
</apex:page>